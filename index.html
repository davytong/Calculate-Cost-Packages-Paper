<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>ðŸ“„ Paper Package & Cost Calculator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #eef2f6;
        padding: 8px;
      }
      .container {
        background: #fff;
        padding: 12px;
        border-radius: 8px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
      }
      .main-title {
        font-weight: 800;
        font-size: 1.4rem;
        text-align: center;
        color: #0d6efd;
        padding-bottom: 10px;
        border-bottom: 3px solid #0d6efd;
        margin-bottom: 16px;
      }
      table {
        width: 100%;
        table-layout: fixed;
        border-collapse: collapse;
        font-size: 0.84rem;
      }
      th,
      td {
        border: 1px solid #d0cecf;
        padding: 6px;
        text-align: center;
        vertical-align: middle;
      }
      .summary-card {
        border: 1px solid #e6e6e6;
        padding: 10px;
        border-radius: 8px;
      }
      .summary-card .value {
        font-weight: 700;
        font-size: 1.05rem;
        color: #0d6efd;
      }
      @media print {
        .no-print,
        button {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="main-title">ðŸ“„ Paper Package & Cost Calculator</div>

      <!-- input -->
      <div class="mb-3">
        <label class="form-label fw-bold">Number of Books:</label>
        <input id="numBooks" class="form-control" type="number" min="1" />
      </div>

      <!-- dynamic book inputs -->
      <div id="bookTableContainer"></div>

      <!-- results -->
      <div id="resultArea" style="display: none">
        <h5 class="mt-3">ðŸ“Š Calculation Result</h5>

        <table class="table table-sm">
          <thead class="table-primary">
            <tr>
              <th>Book #</th>
              <th>Paper + Material</th>
              <th>Total Sheets</th>
              <th>Qty (books)</th>
              <th>Binding</th>
              <th>Price / Book</th>
            </tr>
          </thead>
          <tbody id="resultBody"></tbody>
        </table>

        <h5 class="mt-3 text-warning">ðŸ“„ Paper Packs Needed</h5>
        <table class="table table-sm">
          <thead class="table-warning">
            <tr>
              <th>Paper Type</th>
              <th>Total Sheets</th>
              <th>Packs Needed</th>
            </tr>
          </thead>
          <tbody id="packBody"></tbody>
        </table>

        <!-- summary cards -->
        <div id="summaryBox" class="mt-3">
          <h5 class="fw-bold">ðŸ“Œ Summary</h5>
          <div class="row g-2" id="summaryCards">
            <!-- cards inserted by JS -->
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
      /* ---------- CONFIG (your rules) ---------- */
      const TONER_COST_PER_SHEET = 962 / 90000;
      const INSIDE_COST_A4 = 31 / 4000;
      const INSIDE_COST_A3 = 31 / 2000;
      const COVER_COST = 18 / 400;
      const LAM_COST = 8 / 400;
      const BINDING_COST = 150 / 10000;
      const STAPLE_COST = (17 / 20 / 1000) * 2;

      // base pack sizes (raw) and cut rules
      const BASE_WF = 500; // WF base pack
      const BASE_MT = 250; // MT base pack (you specified)
      const BASE_A3 = 500; // A3 base pack

      const CUT_A4 = 8; // A4 cut = 8
      const CUT_A3 = 4; // A3 cut = 4

      const PACK_WF_A4 = BASE_WF * CUT_A4; // 500 * 8 = 4000
      const PACK_MT_A4 = BASE_MT * CUT_A4; // 250 * 8 = 2000
      const PACK_A3 = BASE_A3 * CUT_A3; // 500 * 4 = 2000

      const COVER_PACK = 400; // GL cover pack

      /* ---------- FORMAT HELPERS ---------- */
      function fmtInt(n) {
        return Number(n).toLocaleString();
      }
      function fmtPrice(n) {
        return "$" + Number(n).toFixed(2);
      }

      /* ---------- UI: create book table ---------- */
      function createBookTable() {
        const n = parseInt($("#numBooks").val());
        if (!n || n < 1) {
          $("#bookTableContainer").html("");
          $("#resultArea").hide();
          return;
        }

        let html = `<table class="table table-sm">
    <thead class="table-light"><tr>
      <th>#</th><th>Pages</th><th>Qty</th><th>Paper</th><th>Material</th><th>Binding</th>
    </tr></thead><tbody>`;
        for (let i = 1; i <= n; i++) {
          html += `<tr>
      <td>${i}</td>
      <td><input type="number" id="pages${i}" class="form-control form-control-sm" min="1" /></td>
      <td><input type="number" id="qty${i}" class="form-control form-control-sm" min="1" /></td>
      <td>
        <select id="paper${i}" class="form-select form-select-sm">
          <option value="A4">A4</option>
          <option value="A3">A3</option>
        </select>
      </td>
      <td>
        <select id="material${i}" class="form-select form-select-sm">
          <option value="WF">WF</option>
          <option value="MT">MT</option>
        </select>
      </td>
      <td>
        <select id="binding${i}" class="form-select form-select-sm">
          <option value="Perfect">Perfect</option>
          <option value="Staple">Staple</option>
        </select>
      </td>
    </tr>`;
        }
        html += `</tbody></table>`;
        $("#bookTableContainer").html(html);

        // recalc on any change
        $("input, select").on("input change", updateCalculation);
      }

      /* ---------- MAIN CALCULATION ---------- */
      function updateCalculation() {
        const n = parseInt($("#numBooks").val());
        if (!n || n < 1) {
          $("#resultArea").hide();
          return;
        }

        $("#resultBody").html("");
        $("#packBody").html("");
        $("#summaryCards").html("");

        let totalBooksQty = 0;
        let totalCoverSheets = 0;
        let totalCost = 0;

        // totals per paper
        let totalSheetsWF = 0; // A4 WF
        let totalSheetsMT = 0; // A4 MT
        let totalSheetsA3 = 0; // A3 (WF or MT â€” we count any A3 into same pool)

        for (let i = 1; i <= n; i++) {
          const pages = parseInt($("#pages" + i).val()) || 0;
          const qty = parseInt($("#qty" + i).val()) || 0;
          const paper = $("#paper" + i).val();
          const material = $("#material" + i).val();
          const binding = $("#binding" + i).val();

          if (pages <= 0 || qty <= 0) continue;

          const sheetsPerBook = Math.ceil(pages / 2); // your rule
          const totalSheetsForLines = sheetsPerBook * qty;

          // toner calculation (approx)
          const tonerSheets =
            paper === "A4" ? sheetsPerBook + 4 : sheetsPerBook * 2 + 4;
          const tonerCost = tonerSheets * TONER_COST_PER_SHEET;
          const insideCost =
            paper === "A4"
              ? sheetsPerBook * INSIDE_COST_A4
              : sheetsPerBook * INSIDE_COST_A3;
          const coverCost = COVER_COST;
          const lamCost = LAM_COST;
          const bindCost = binding === "Perfect" ? BINDING_COST : STAPLE_COST;

          const pricePerBook =
            tonerCost + insideCost + coverCost + lamCost + bindCost;

          // accumulate totals
          totalBooksQty += qty;
          totalCoverSheets += qty;
          totalCost += pricePerBook * qty;

          if (paper === "A4" && material === "WF")
            totalSheetsWF += totalSheetsForLines;
          if (paper === "A4" && material === "MT")
            totalSheetsMT += totalSheetsForLines;
          if (paper === "A3") totalSheetsA3 += totalSheetsForLines;

          // result row
          $("#resultBody").append(`<tr>
      <td>${i}</td>
      <td>${paper} - ${material}</td>
      <td>${fmtInt(totalSheetsForLines)}</td>
      <td>${fmtInt(qty)}</td>
      <td>${binding}</td>
      <td>${fmtPrice(pricePerBook)}</td>
    </tr>`);
        }

        // packs needed (use your cut rules)
        const packsWF =
          totalSheetsWF > 0 ? Math.ceil(totalSheetsWF / PACK_WF_A4) : 0;
        const packsMT =
          totalSheetsMT > 0 ? Math.ceil(totalSheetsMT / PACK_MT_A4) : 0;
        const packsA3 =
          totalSheetsA3 > 0 ? Math.ceil(totalSheetsA3 / PACK_A3) : 0;

        // cover packs (GL) always calculated from cover sheets
        const coverPacks =
          totalCoverSheets > 0 ? Math.ceil(totalCoverSheets / COVER_PACK) : 0;

        // pack table: show only used paper types + cover
        if (totalSheetsWF > 0) {
          $("#packBody").append(
            `<tr><td>A4 - WF</td><td>${fmtInt(totalSheetsWF)}</td><td>${fmtInt(
              packsWF
            )}</td></tr>`
          );
        }
        if (totalSheetsMT > 0) {
          $("#packBody").append(
            `<tr><td>A4 - MT</td><td>${fmtInt(totalSheetsMT)}</td><td>${fmtInt(
              packsMT
            )}</td></tr>`
          );
        }
        if (totalSheetsA3 > 0) {
          $("#packBody").append(
            `<tr><td>A3 - WF</td><td>${fmtInt(totalSheetsA3)}</td><td>${fmtInt(
              packsA3
            )}</td></tr>`
          );
        }
        // cover GL packs row
        if (totalCoverSheets > 0) {
          $("#packBody").append(
            `<tr><td>Cover GL</td><td>${fmtInt(
              totalCoverSheets
            )}</td><td>${fmtInt(coverPacks)}</td></tr>`
          );
        }

        // SUMMARY CARDS (Option B: card per item; only show WF/MT/A3 if >0)
        // always show Total Books, Total Cover Sheets, Total Cost, GL Packs
        const cards = [];

        cards.push({
          title: "Total Books",
          value: fmtInt(totalBooksQty),
        });
        cards.push({
          title: "Total Cover Sheets",
          value: fmtInt(totalCoverSheets),
        });
        cards.push({
          title: "Total Cost ($)",
          value: fmtPrice(totalCost),
        });
        cards.push({
          title: "GL Packs (Cover)",
          value: fmtInt(coverPacks),
        });

        if (packsWF > 0)
          cards.push({ title: "A4 WF Packs", value: fmtInt(packsWF) });
        if (packsMT > 0)
          cards.push({ title: "A4 MT Packs", value: fmtInt(packsMT) });
        if (packsA3 > 0)
          cards.push({ title: "A3 WF Packs", value: fmtInt(packsA3) });

        // render cards in a 2-up grid on small screens, 4-up on wide screens
        $("#summaryCards").html("");
        cards.forEach((c) => {
          const col = $('<div class="col-6 col-md-3"></div>');
          const card = $(
            `<div class="summary-card text-center"><div class="fw-bold">${c.title}</div><div class="value mt-2">${c.value}</div></div>`
          );
          col.append(card);
          $("#summaryCards").append(col);
        });

        // show result area
        $("#resultArea").show();
        $("#summaryBox").show();
      }
      /* ---------- events ---------- */
      $(document).ready(function () {
        $("#numBooks").on("input", createBookTable);
      });
    </script>
  </body>
</html>
