<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title style="font-weight: bold">ðŸ“„ Paper Package & Cost Calculator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: #eef2f6;
        padding: 5px;
      }
      .container {
        background: #fff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .main-title {
        font-weight: 800;
        font-size: 1.6rem;
        text-align: center;
        padding: 12px 0;
        color: #0d6efd;
        text-transform: uppercase;
        border-bottom: 3px solid #0d6efd;
        margin-bottom: 20px;
      }

      table {
        width: 100%;
        table-layout: fixed;
        border-collapse: collapse;
        font-size: 0.75rem;
      }
      th,
      td {
        border: 1px solid #aeacac;
        text-align: center;
        padding: 3px;
        vertical-align: middle;
      }

      .summary-box strong {
        font-size: 1.1rem;
        color: #007bff;
      }

      @media print {
        .no-print,
        button {
          display: none !important;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h5 class="main-title">ðŸ“„ Paper Package & Cost Calculator</h5>

      <div class="mb-3">
        <label class="form-label fw-bold">Number of Books:</label>
        <input type="number" id="numBooks" class="form-control" min="1" />
      </div>

      <div id="bookTableContainer"></div>

      <!-- =================================================== -->
      <!--     RESULT TABLE (SUMMARY PER BOOK)                 -->
      <!-- =================================================== -->

      <div id="resultTable" style="display: none">
        <h4 class="fw-bold mt-3">ðŸ“Š Calculation Result</h4>

        <table class="table table-bordered table-sm">
          <thead class="table-primary">
            <tr>
              <th>Book #</th>
              <th>Paper + Material</th>
              <th>Total Sheets</th>
              <th>Cover Sheets</th>
              <th>GL Packs (Shared)</th>
              <th>Binding</th>
              <th>Price per Book ($)</th>
            </tr>
          </thead>
          <tbody id="resultBody"></tbody>
        </table>

        <!-- =================================================== -->
        <!--    NEW DETAILED COST BREAKDOWN TABLE                -->
        <!-- =================================================== -->
        <h4 class="fw-bold mt-4 text-success">ðŸ“¦ Detailed Cost Breakdown</h4>

        <table class="table table-bordered table-sm">
          <thead class="table-success">
            <tr>
              <th>Book #</th>
              <th>Toner ($)</th>
              <th>Inside Paper ($)</th>
              <th>Cover ($)</th>
              <th>Laminate ($)</th>
              <th>Glue / Staple ($)</th>
              <th>Total ($)</th>
            </tr>
          </thead>
          <tbody id="detailBody"></tbody>
        </table>

        <!-- =================================================== -->
        <!--              SUMMARY BOX                             -->
        <!-- =================================================== -->
        <div
          id="summaryBox"
          class="summary-box card p-3 mt-3"
          style="display: none"
        >
          <h5 class="text-primary fw-bold">ðŸ“Œ Summary</h5>

          <div class="row">
            <div class="col-6 col-md-3 mb-2">
              <div class="border p-2 rounded text-center">
                <div class="fw-bold">Total Books</div>
                <strong id="sumTotalBooks">0</strong>
              </div>
            </div>

            <div class="col-6 col-md-3 mb-2">
              <div class="border p-2 rounded text-center">
                <div class="fw-bold">Total Cover Sheets</div>
                <strong id="sumCoverSheets">0</strong>
              </div>
            </div>

            <div class="col-6 col-md-3 mb-2">
              <div class="border p-2 rounded text-center">
                <div class="fw-bold">Total GL Packs (Shared)</div>
                <strong id="sumCoverGL">0</strong>
              </div>
            </div>

            <div class="col-6 col-md-3 mb-2">
              <div class="border p-2 rounded text-center">
                <div class="fw-bold">Total Cost ($)</div>
                <strong id="sumTotalCost">0.00</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
      <script>
        /* COST SETTINGS */
        const TonerCostPerSheet = 962 / 90000;
        const InsideBookCostA4 = 31 / 4000;
        const InsideBookCostA3 = 31 / 2000;
        const CoverCost = 18 / 400;
        const LaminateCost = 8 / 400;
        const BindingCost = 150 / 10000;
        const StapleCost = (17 / 20 / 1000) * 2;

        const coverPackCapacity = 400; // 100 sheets Ã— cut 4 = 400

        function formatNum(n) {
          return Number(n).toFixed(4);
        }

        /* DYNAMIC TABLE CREATOR */
        function createBookTable() {
          const num = parseInt($("#numBooks").val());
          if (!num) return;

          let html = `
          <table class="table table-bordered table-sm">
            <thead class="table-primary">
              <tr>
                <th>Book #</th>
                <th>Pages</th>
                <th>Qty</th>
                <th>Paper</th>
                <th>Material</th>
                <th>Binding</th>
              </tr>
            </thead><tbody>`;

          for (let i = 1; i <= num; i++) {
            html += `
              <tr>
                <td>${i}</td>
                <td><input type="number" id="pages${i}" class="form-control"></td>
                <td><input type="number" id="qty${i}" class="form-control"></td>
                <td><select id="paper${i}" class="form-select">
                      <option value="A4">A4</option>
                      <option value="A3">A3</option>
                    </select></td>
                <td><select id="material${i}" class="form-select">
                      <option>WF</option>
                      <option>MT</option>
                    </select></td>
                <td><select id="binding${i}" class="form-select">
                      <option value="Perfect">Perfect</option>
                      <option value="Staple">Staple</option>
                    </select></td>
              </tr>`;
          }

          html += `</tbody></table>`;
          $("#bookTableContainer").html(html);

          $("input, select").on("input change", updateCalculation);
        }

        $("#numBooks").on("input", createBookTable);

        /* MAIN CALCULATION */
        function updateCalculation() {
          const numBooks = parseInt($("#numBooks").val());
          if (!numBooks) return;

          $("#resultBody").html("");
          $("#detailBody").html("");

          let totalBooks = 0;
          let totalCovers = 0;
          let totalCost = 0;

          for (let i = 1; i <= numBooks; i++) {
            const pages = parseInt($("#pages" + i).val()) || 0;
            const qty = parseInt($("#qty" + i).val()) || 0;
            const paper = $("#paper" + i).val();
            const binding = $("#binding" + i).val();

            if (pages <= 0 || qty <= 0) continue;

            /* MAIN SHEET CALC */
            const sheets = Math.ceil(pages / 2);
            const coverSheets = 1; // 1 cover per book

            /* COST PARTS */
            const tonerSheets = paper === "A4" ? sheets + 4 : sheets * 2 + 4;
            const tonerCost = tonerSheets * TonerCostPerSheet;

            const insideCost =
              paper === "A4"
                ? sheets * InsideBookCostA4
                : sheets * InsideBookCostA3;

            const coverCost = CoverCost;
            const lamCost = LaminateCost;
            const bindCost = binding === "Perfect" ? BindingCost : StapleCost;

            const pricePerBook =
              tonerCost + insideCost + coverCost + lamCost + bindCost;

            /* SUBTOTAL ACCUMULATION */
            totalBooks += qty;
            totalCovers += qty;

            totalCost += pricePerBook * qty;

            /* RESULT TABLE */
            $("#resultBody").append(`
              <tr>
                <td>${i}</td>
                <td>${paper}</td>
                <td>${sheets * qty}</td>
                <td>${qty}</td>
                <td>Shared</td>
                <td>${binding}</td>
                <td>${formatNum(pricePerBook)}</td>
              </tr>
            `);

            /* DETAILED BREAKDOWN TABLE */
            $("#detailBody").append(`
              <tr>
                <td>${i}</td>
                <td>${formatNum(tonerCost)}</td>
                <td>${formatNum(insideCost)}</td>
                <td>${formatNum(coverCost)}</td>
                <td>${formatNum(lamCost)}</td>
                <td>${formatNum(bindCost)}</td>
                <td>${formatNum(pricePerBook)}</td>
              </tr>
            `);
          }

          /* GL PACKS FOR ALL BOOKS (SHARED) */
          const totalGLPacks = Math.ceil(totalCovers / coverPackCapacity);

          /* SHOW SUMMARY */
          $("#sumTotalBooks").text(totalBooks);
          $("#sumCoverSheets").text(totalCovers);
          $("#sumCoverGL").text(totalGLPacks);
          $("#sumTotalCost").text(formatNum(totalCost));

          $("#resultTable").show();
          $("#summaryBox").show();
        }
      </script>
    </div>
  </body>
</html>
